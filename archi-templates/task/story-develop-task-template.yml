id: story-develop-task-template
name: 故事研发任务模板
description: 标准任务流程：编写方案 → 制定研发计划 → 研发实现 → 归档更新
category: task
# 步骤定义
steps:
  - id: draft-proposal
    type: DraftProposalStep
    form:
      title: 编写方案
      schema:
        content:
          type: textarea
          title: 编写方案
          description: |
            💡 提示：请关注以下要点：
            1. 需求分析：明确任务目标和业务价值
            2. 技术方案：选择合适的技术栈和架构模式
            3. 实施计划：制定清晰的实施步骤和时间安排
            4. 风险评估：识别潜在风险并制定应对措施
            5. 关联文件：考虑对现有文档和代码的影响
          required: false
    prompt: |
      你是一个**专业的解决方案架构师 / 方案顾问**，需要基于以下信息**编写方案**：

      * **任务名称**：{{ task.name }}
      * **方案路径**：{{ solutionPath }}
      * **方案要求**：{{ formDataItems[0].value }}

      ---

      ## 方案编写思路（链式提示）

      1. **背景与现状分析**

        * 分析任务背景、业务目标和当前存在的问题
        * 结合参考材料，梳理现有方案或系统的核心思路与不足

      2. **总体方案设计**

        * 明确方案目标、设计原则和适用范围
        * 给出整体解决思路和方案框架（可包含对比方案）

      3. **方案详细说明**

        * 从架构、流程、功能、实施路径等维度展开说明
        * 重点说明关键决策点、核心设计和创新点

      4. **可行性与影响评估**

        * 分析方案的技术可行性、实施成本、风险点及应对策略
        * 说明方案对现有系统、流程或团队的影响

      5. **实施路径**

        * 给出清晰的实施步骤和关键决策点
        * 明确方案落地所需资源和配合条件


      ## 方案撰写约束

      1. 方案结构清晰，逻辑严谨，语言专业、正式
      2. 内容应围绕"决策支持"和"可落地性"，避免过度技术细节
      3. 与参考文件在**思路、术语和表达风格**上保持一致
      4. 重点结论明确，可被管理层或评审人员快速理解
      5. 必要时使用列表、分级标题或表格增强可读性
      6. **任务粒度说明**：本任务聚焦于研发故事级别的实现，而非大的特性或里程碑，方案应简洁实用，聚焦当前故事的核心目标

      ## 参考资料 / 相关文件

      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}

      * {{ codePath }}
        {% endfor %}
        {% else %}
        （暂无关联参考资料）
        {% endif %}
    depends_on: []
  - id: develop-plan
    type: DevelopPlanStep
    form:
      title: 制定研发计划
      schema:
        content:
          type: textarea
          title: 研发计划内容
          description: |
            💡 提示：请关注以下要点：
            1. 任务拆分：将方案转化为可执行的开发任务清单
            2. 执行顺序：明确任务的依赖关系和开发顺序
            3. 开发规范：明确代码结构、命名规范、接口风格和设计原则
            4. 测试计划：给出功能测试和关键场景验证方式
          required: false
    prompt: |
      你是一个**资深技术负责人 / 研发架构师**，需要基于已批准的解决方案，**制定可执行的研发计划**，将方案转化为具体的开发任务和执行步骤。

      ---

      ### 基本信息

      * **任务名称**：{{ task.name }}
      * **方案路径**：{{ solutionPath }}
      * **研发计划要求**：{{ formDataItems[0].value }}

      ---

      ## 研发计划制定链式提示

      1. **方案理解与任务转化**

        * 理解方案中的技术架构、模块划分和实现策略（方案中已明确，无需重新设计）
        * 将方案中的实施路径转化为具体的开发任务清单
        * 明确每个开发任务的目标、输入和输出

      2. **任务拆分与依赖分析**

        * 将开发任务进一步拆分为可执行的子任务
        * 分析任务间的依赖关系，确定合理的开发顺序
        * 识别可以并行开发的任务和必须串行的任务

      3. **开发规范与约束**

        * 明确代码结构、命名规范、接口风格和设计原则
        * 要求与现有系统、代码库或平台保持一致
        * 说明必须遵循的工程规范、质量标准和安全要求

      4. **测试计划**

        * 为每个开发任务明确对应的测试验证方式
        * 明确功能测试和关键场景验证的验收标准
        * 指出需要重点关注的风险点和验证要点

      ---

      ## 研发计划约束

      1. **严格基于既定方案**：计划应直接转化方案内容，不重新设计架构或技术选型（这些已在方案中确定）
      2. **聚焦任务拆分**：重点是将方案转化为可执行的开发任务，而非重新分析需求或设计架构
      3. **任务粒度适中**：每个开发任务应聚焦当前研发故事的核心功能，避免过度拆分或规划大的特性
      4. **可执行性**：计划应足够详细，开发人员可直接按照任务清单执行，无需再次决策
      5. 与现有系统保持兼容，避免破坏性变更

      ---

      ## 参考资料 / 相关资源

      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}

      * {{ codePath }}
        {% endfor %}
        {% else %}
        （暂无关联代码或实施参考）
        {% endif %}
    depends_on:
      - draft-proposal
  - id: implementation
    type: ImplementationStep
    form:
      title: 研发实现
      schema:
        content:
          type: textarea
          title: 研发实现内容
          description: |
            💡 提示：请关注以下要点：
            1. 代码实现：参考研发计划和关联代码路径，按照既定架构实现核心功能模块
            2. 代码结构：创建清晰的目录结构和模块划分，符合既定的设计规范
            3. 接口实现：实现模块间的接口定义和数据交互，确保与现有系统兼容
            4. 代码质量：遵循命名规范、代码风格和设计原则，确保可读性和可维护性
            5. 单元测试：编写单元测试覆盖核心业务逻辑和关键路径
            6. 集成测试：编写集成测试验证模块协作和系统集成
            7. 代码审查：进行代码自检和优化，确保质量达到可交付标准
          required: false
    prompt: |
      你是一个**资深开发工程师 / 技术实现专家**，需要基于已批准的研发计划，**实际编写代码并完成功能实现**，确保代码质量、可维护性和符合既定规范。

      ---

      ### 基本信息

      * **任务名称**：{{ task.name }}
      * **方案路径**：{{ solutionPath }}
      * **实现要求与约束**：{{ formDataItems[0].value }}

      ---

      ## 代码实现链式提示

      1. **计划理解与实现准备**

        * 准确理解研发计划中的技术架构、模块划分和实现策略
        * 明确本次实现的具体范围、技术选型和开发规范
        * 检查并准备必要的开发环境、依赖和工具

      2. **代码结构与模块实现**

        * 按照计划中的架构设计，创建清晰的目录结构和模块划分
        * 实现核心业务逻辑和关键功能模块
        * 确保代码结构符合既定的设计原则和规范要求

      3. **接口与集成实现**

        * 实现模块间的接口定义和数据交互
        * 完成与现有系统的集成和兼容性处理
        * 确保接口设计符合既定的接口风格和规范

      4. **代码质量与规范**

        * 遵循既定的代码结构、命名规范和设计原则
        * 确保代码具备良好的可读性、可维护性和可扩展性
        * 符合工程规范、质量标准和安全要求

      5. **测试编写与验证**

        * 编写单元测试，覆盖核心业务逻辑和关键路径
        * 编写集成测试，验证模块间的协作和系统集成
        * 执行测试并确保通过，修复发现的问题

      6. **代码审查与优化**

        * 进行代码自检，确保符合规范和最佳实践
        * 识别并优化代码中的潜在问题和性能瓶颈
        * 确保代码质量达到可交付标准

      ---

      ## 代码实现约束

      1. 严格遵循研发计划中的技术架构和实现策略，不随意偏离
      2. 确保代码实现与现有系统保持兼容，避免破坏性变更
      3. 关键代码需包含必要的注释说明
      4. 代码应具备良好的可测试性，关键逻辑需有测试覆盖
      5. 实现过程中如发现计划问题，应及时反馈并协商调整
      6. **任务粒度说明**：本任务聚焦于研发故事级别的实现，代码实现应聚焦当前故事的核心功能，避免过度设计

      ---

      ## 参考资料 / 相关资源

      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}

      * {{ codePath }}
        {% endfor %}
        {% else %}
        （暂无关联代码或实施参考）
        {% endif %}
    depends_on:
      - develop-plan
  - id: archive-update
    type: ArchiveUpdateStep
    form:
      title: 归档更新
      schema:
        content:
          type: textarea
          title: 文档更新内容
          description: |
            💡 提示：请关注以下要点：
            1. 文档列表：列出所有需要更新或创建的文档
            2. 更新内容：基于实现后的代码，更新文档的具体内容
            3. 文档结构：确保文档结构清晰、易于理解
            4. 归档建议：提供文档归档的位置和分类建议
            5. 版本管理：考虑文档版本控制和历史记录
          required: false
    prompt: |
      你是一个**专业的文档管理专家 / 知识库维护者**，需要基于研发实现结果，**更新相关文档**，确保文档与代码实现保持一致。

      ---

      ### 基本信息

      * **任务名称**：{{ task.name }}
      * **方案路径**：{{ solutionPath }}
      * **文档更新要求**：{{ formDataItems[0].value }}

      ---

      ## 文档更新链式提示

      1. **文档识别**

        * 识别需要更新的关联文档（优先考虑方案文档和技术文档）
        * 明确各文档的更新范围和优先级

      2. **内容更新**

        * 基于实现后的代码，更新文档的具体内容
        * 确保文档准确反映代码实现和关键设计

      3. **归档位置**

        * 提供文档归档的位置建议
        * 遵循既定的文档管理规范和知识库结构

      ---

      ## 文档更新约束

      1. 严格基于实际代码实现，确保文档与代码一致
      2. 遵循既定的文档规范和知识库结构
      3. 优先更新关联文档，避免创建过多新文档
      4. **任务粒度说明**：本任务聚焦于研发故事级别的文档更新，应简洁实用，仅更新必要的关联文档
      5. 输出内容应包含明确的更新清单和具体更新建议

      ---

      ## 关联文档与代码资源

      ### 关联文档（可能需要更新的文档）

      {% if relatedDocuments %}
      {% for doc in relatedDocuments %}
      * {{ doc.name }}: {{ doc.path }}
        {% if doc.vaultName %}所属 Vault: {{ doc.vaultName }}{% endif %}
      {% endfor %}
      {% else %}
      （暂无关联文档）
      {% endif %}

      ### 关联代码路径（实现后的代码，用于更新文档）

      {% if relatedCodePaths %}
      {% for codePath in relatedCodePaths %}
      * {{ codePath }}
      {% endfor %}
      {% else %}
      （暂无关联代码路径）
      {% endif %}
    depends_on:
      - implementation
